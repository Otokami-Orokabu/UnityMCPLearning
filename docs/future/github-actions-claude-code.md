# GitHub Actions での Claude Code 設定ガイド

## 📊 概要

GitHub Actions に Claude Code を統合することで、CI/CDパイプライン内でAIを活用した自動化が可能になります。Unity MCPプロジェクトでは、テスト自動化、コード品質チェック、ドキュメント生成などに活用できます。

## 🎯 Claude Code × GitHub Actions の可能性

### **現在考えられる統合方法**

#### **1. API キーベースの統合**
```yaml
name: Claude Code Integration
on: [push, pull_request]

jobs:
  claude-analysis:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Claude Code
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: |
          # Claude Code CLI インストール
          npm install -g @anthropic-ai/claude-code
          # または pip install claude-code
          
      - name: Analyze Code Quality
        run: |
          claude-code analyze --project ./unity-mcp-node
          claude-code test --generate-missing
```

#### **2. MCP サーバー統合**
```yaml
name: Unity MCP Validation
on: [push, pull_request]

jobs:
  unity-validation:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Unity MCP
        run: |
          cd unity-mcp-node
          npm install
          npm run build
          
      - name: Start MCP Server
        run: |
          npm start &
          sleep 5  # サーバー起動待機
          
      - name: Claude Code MCP Test
        env:
          CLAUDE_MCP_SERVER: "localhost:3000"
        run: |
          claude-code mcp connect unity-mcp-server
          claude-code mcp test "create 10 test cubes"
          claude-code mcp test "validate scene structure"
```

## 🛠️ Unity MCP 専用の活用例

### **1. 自動テスト生成**

#### **TypeScript テスト自動生成**
```yaml
name: Auto Generate Tests
on:
  push:
    paths:
      - 'unity-mcp-node/src/**'

jobs:
  generate-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Generate Missing Tests
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: |
          claude-code analyze src/index.ts \
            --prompt "Generate Jest unit tests for all functions that don't have tests" \
            --output tests/generated/
          
      - name: Run Generated Tests
        run: |
          npm test tests/generated/
          
      - name: Create PR for Tests
        if: success()
        uses: peter-evans/create-pull-request@v5
        with:
          title: "Auto-generated tests for MCP server"
          body: "Generated by Claude Code in GitHub Actions"
          branch: auto-tests-${{ github.sha }}
```

### **2. Unity シーン検証**

#### **シーン構造自動チェック**
```yaml
name: Unity Scene Validation
on:
  push:
    paths:
      - 'MCPLearning/Assets/Scenes/**'

jobs:
  validate-scenes:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Unity & Claude Code
        run: |
          # Unity Editor インストール
          wget -qO- https://get.unity3d.com/linux.sh | bash
          
          # Claude Code セットアップ
          npm install -g @anthropic-ai/claude-code
          
      - name: Start Unity & MCP
        run: |
          # Unity をバックグラウンドで起動
          unity-editor -batchmode -projectPath ./MCPLearning &
          
          # MCP サーバー起動
          cd unity-mcp-node && npm start &
          
      - name: Validate Scene Structure
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: |
          claude-code mcp unity << 'EOF'
          # シーン構造の検証
          scene_info = get_scene_info()
          
          # 必須オブジェクトの存在確認
          required_objects = ["Main Camera", "Directional Light"]
          for obj in required_objects:
              if obj not in scene_info.objects:
                  raise Exception(f"Required object {obj} not found")
          
          # パフォーマンスチェック
          if scene_info.polygon_count > 100000:
              print("WARNING: High polygon count detected")
          
          # ライティング設定確認
          lighting_info = get_lighting_info()
          if not lighting_info.baked_lighting:
              print("INFO: Consider baking lighting for better performance")
          EOF
```

### **3. ドキュメント自動更新**

#### **API ドキュメント生成**
```yaml
name: Auto Update Documentation
on:
  push:
    branches: [main]

jobs:
  update-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Generate API Documentation
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: |
          # TypeScript コードからドキュメント生成
          claude-code document \
            --input "unity-mcp-node/src/**/*.ts" \
            --output "docs/api/" \
            --format markdown \
            --include-examples
          
          # Unity C# コードからドキュメント生成
          claude-code document \
            --input "MCPLearning/Assets/UnityMCP/**/*.cs" \
            --output "docs/unity-api/" \
            --format markdown \
            --include-examples
      
      - name: Update README
        run: |
          claude-code update-readme \
            --project-status ./PROJECT_STATUS.md \
            --api-docs ./docs/api/ \
            --output ./README.md
      
      - name: Commit Documentation
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/ README.md
          git commit -m "Auto-update documentation via Claude Code" || exit 0
          git push
```

## 🔧 詳細設定例

### **Claude Code 設定ファイル**

#### **.claude-code.yml**
```yaml
# プロジェクト設定
project:
  name: "Unity MCP Learning"
  type: "unity-mcp"
  
# コード分析設定
analysis:
  languages: ["typescript", "csharp"]
  frameworks: ["node.js", "unity"]
  
  rules:
    - check_test_coverage: true
    - min_coverage: 80
    - check_documentation: true
    - unity_best_practices: true

# テスト生成設定
testing:
  jest:
    config_path: "unity-mcp-node/jest.config.js"
    test_pattern: "**/*.test.ts"
  
  unity:
    test_assembly: "UnityMCP.Editor.Tests"
    test_pattern: "**/*Tests.cs"

# ドキュメント生成設定
documentation:
  api_output: "docs/api/"
  format: "markdown"
  include_examples: true
  auto_update_readme: true

# MCP 統合設定
mcp:
  server_path: "unity-mcp-node/dist/index.js"
  unity_project: "MCPLearning"
  test_commands:
    - "ping"
    - "create_cube"
    - "unity_info_realtime"
```

### **Secrets 設定**

#### **必要な環境変数**
```bash
# GitHub リポジトリの Settings > Secrets で設定
CLAUDE_API_KEY=sk-ant-api03-...
UNITY_LICENSE=<Unity Pro License>
UNITY_EMAIL=<Unity アカウント>
UNITY_PASSWORD=<Unity パスワード>
```

### **高度なワークフロー例**

#### **完全な CI/CD パイプライン**
```yaml
name: Complete Unity MCP Pipeline
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  # Step 1: コード品質チェック
  code-quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Claude Code Quality Analysis
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: |
          claude-code analyze --all
          claude-code security-scan
          claude-code performance-check
  
  # Step 2: テスト実行
  testing:
    needs: code-quality
    runs-on: ubuntu-latest
    strategy:
      matrix:
        unity-version: [2022.3.21f1, 6000.1.5f1]
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Unity
        uses: unity-ci/setup-unity@v1
        with:
          unity-version: ${{ matrix.unity-version }}
          unity-license: ${{ secrets.UNITY_LICENSE }}
      
      - name: Run Tests with Claude Code
        run: |
          # TypeScript テスト
          cd unity-mcp-node
          npm test
          
          # Unity テスト
          claude-code mcp unity test-all
          
          # 統合テスト
          claude-code integration-test \
            --unity-version ${{ matrix.unity-version }}
  
  # Step 3: ドキュメント更新
  documentation:
    needs: testing
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Update Documentation
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: |
          claude-code generate-docs --auto-commit
  
  # Step 4: リリース作成
  release:
    needs: [testing, documentation]
    if: startsWith(github.ref, 'refs/tags/v')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Create Release with Claude Code
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # リリースノート自動生成
          claude-code generate-release-notes \
            --from-tag ${{ github.event.before }} \
            --to-tag ${{ github.sha }}
          
          # パッケージビルド
          claude-code build-packages --all-platforms
          
          # GitHub Release 作成
          gh release create ${{ github.ref_name }} \
            --notes-file release-notes.md \
            --title "Unity MCP ${{ github.ref_name }}"
```

## 🚀 期待される効果

### **開発効率の向上**
- **自動テスト生成**: 手動テスト作成時間を80%削減
- **コード品質維持**: リアルタイムでの品質チェック
- **ドキュメント同期**: コードとドキュメントの自動同期

### **品質向上**
- **一貫性のあるコード**: AI による統一されたコーディングスタイル
- **セキュリティ強化**: 自動的なセキュリティ脆弱性検出
- **パフォーマンス最適化**: AI による最適化提案

### **チーム効率化**
- **コードレビュー支援**: 自動的な改善提案
- **新人教育**: AI による学習支援
- **知識共有**: 自動的なベストプラクティス適用

## ⚠️ 注意事項・制限事項

### **技術的制限**
- **API レート制限**: Claude API の使用量制限
- **Unity ライセンス**: CI/CDでのUnity Pro ライセンス必要
- **実行時間制限**: GitHub Actions の実行時間制限

### **セキュリティ考慮事項**
```yaml
# セキュリティ設定例
security:
  api_keys:
    - store_in_secrets: true
    - rotation_schedule: "monthly"
  
  code_access:
    - limit_to_public_repos: false
    - review_ai_suggestions: true
  
  data_handling:
    - no_sensitive_data: true
    - audit_logging: true
```

### **コスト管理**
```yaml
# コスト最適化設定
cost_management:
  usage_limits:
    daily_api_calls: 1000
    monthly_budget: 100  # USD
  
  optimization:
    cache_results: true
    batch_requests: true
    smart_triggering: true  # 必要な時のみ実行
```

## 🔗 参考リソース

### **公式ドキュメント**
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Unity CI/CD](https://unity.com/solutions/ci-cd)

### **コミュニティリソース**
- [Unity Actions Marketplace](https://github.com/marketplace?type=actions&query=unity)
- [Claude Code Examples](https://github.com/anthropics/claude-code-examples)

---

**注意**: この文書は現在の推定に基づいており、Claude Code の GitHub Actions 統合の正式な仕様が公開され次第、内容を更新する必要があります。